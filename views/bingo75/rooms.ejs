<%- include('header75'); %> 


    <!--Content-->
    <div class="container boxWrap">
        <div class="row">
            <!-- <div class="col-md-3">
               <div class="row">
               <div class="leftSideBox">
                        <div class="boxTitle">Filter</div>
                        
                        <ul class="allRommsList">
                            <li><a href="#" class="selected">All Rooms <i class="fa fa-angle-double-right"></i></a></li>
                            <li><a href="#">0.00 <i class="fa fa-angle-double-right"></i></a></li>
                            <li><a href="#">0.01 <i class="fa fa-angle-double-right"></i></a></li>
                            <li><a href="#">0.05 <i class="fa fa-angle-double-right"></i></a></li>
                            <li><a href="#">0.10 <i class="fa fa-angle-double-right"></i></a></li>
                            <li><a href="#">0.15 <i class="fa fa-angle-double-right"></i></a></li>
                            <li><a href="#">0.25 <i class="fa fa-angle-double-right"></i></a></li>
                            <li><a href="#">0.50 <i class="fa fa-angle-double-right"></i></a></li>
                        </ul>
                        <div class="adsWrap"><img src="img/ads.png" alt=""></div>
                        <div class="refreshBtn"><a href="#">Refresh</a></div>
                        
                        </div>
                    </div>
               
            </div> -->
            <div class="col-md-12">
                <!-- <div class="row">
                  <div class="col-md-12"> -->
                    <div class="rightSideBox">
                        <div class="boxTitle">Account Information</div>
                        <span id="error"></span>
                        <!-- a/c info box-->
                        <div class="accountInfoBox">
                            <div class="accountInfoBoxWhite">
                                <!-- <h3>Account Information</h3> -->
                                <div class="userName"><span>User Name:</span><span><%= Bingo.user %></span></div>
                                <div class="userName"><span>Total Credits:</span><span><%= Bingo.user_details.total_credits %></span></div>
                                <% if(Bingo.user_bingo_credits > 0) { %>
                                  <div class="userName"><span>Bingo Credits:</span><span><%= Bingo.user_bingo_credits %></span></div>
                                <% } %>
                                <hr>
                                <div id="transfer_div">
                                    <div class="inputBox">
                                        <label for="form1" class="">Credit Transfer</label>
                                        <input type="hidden" name="total_credits"  id="total_credits" class="form-control" value="<%- Bingo.user_details.total_credits %>">
                                        <input type="text" name="transfer_credits" id="transfer_credits" class="txt" placeholder="0.00">
                                    </div>
                                    <div class="inputBox">
                                        <label for="form1" class="">Bingo Credit</label>
                                        <input type="text" name="bingo_credits" id="bingo_credits" class="txt" placeholder="0.00">
                                    </div>
                                    <div class="clearfix"></div>
                                    <a href="#" class="transferBtn" id="transfer"><i class="fa fa-angle-double-right"></i></a>
                                </div>
                            </div>
                            <div class="boxTitle">Bingo rooms</div>
                            <!-- <div class="accountInfoBoxWhite">
                                <div class="inputBox">
                                    <label for="form1" class="">Credit Transfer</label>
                                    <input type="text" id="form1" class="txt" placeholder="0.00">
                                </div>
                                <div class="inputBox">
                                    <label for="form1" class="">Bingo Credit</label>
                                    <input type="text" id="form1" class="txt" placeholder="0.00">
                                </div>
                                <div class="clearfix"></div>
                                <a href="#" class="transferBtn"><i class="fa fa-angle-double-right"></i></a>
                                
                            </div> -->
                        </div>
                    <!-- </div>
                </div> -->
                <div class="row">
                  <div class="col-md-12">
                    <div class="roomBoxWrap">
                        <% if(Bingo.rooms.length > 0){ 
                            for(i=0;i<Bingo.rooms.length;i++){
                        %>
                        
                             <div class="roomListRow chosen-room">
                                
                                  <div class="row">
                                  <div class="col-md-2">
                                    <img src="/assets/img/list_img.jpg" alt="">
                                   </div>
                                   <div class="col-md-4">
                                   <div class="roomDetailsLeft">
                                        <span class="roomTitle"><%= Bingo.rooms[i].name %></span>
                                        
                                        <span class="cardsRoom">Upto <%= Bingo.rooms[i].cards_upto %> cards per room</span> 
                                        <span class="cardsRoom">Choose cards:
                                            <select class="room-cards">
                                                <% 
                                                    for(j=1;j<=Bingo.rooms[i].cards_upto;j++){
                                                %>
                                                <option value="<%= j %>"><%= j %></option>
                                                <% } %>
                                            </select>
                                        </span>      
                                        <span class="cardsRoom">Card Price: <i class="cardPrice">&euro; <%= Bingo.rooms[i].card_price %></i> <!-- Previous round <i class="cardPrice">0.10</i> --></span> 
                                        <a class="btn btn-success" href="#" data-room="<%= Bingo.rooms[i]._id %>" data-game="<%= Bingo.gameinplay._id %>"> 
                                        Enter Room</a>       
                                   </div> 
                                   </div>
                                   <div class="col-md-3">
                                   <div class="roomDetailsLeft">
                                    <span class="roomStatus"><i class="busy"></i>Busy</span>
                                    </div>
                                   </div>
                                   <div class="col-md-3">
                                   <div class="roomDetailsRight">
                                        <span class="cardsRoom">Players</span>      
                                        <span class="cardsRoom">
                                            <i class="numofPlayers">7</i> | <i class="numofPlayers">45</i>
                                        </span> 
                                        <span class="cardsRoom">Number of Balls</span>      
                                        <span class="cardsRoom">
                                            <i class="numofBalls"><%= Bingo.rooms[i].card_balls_to_roll %></i>
                                        </span>    
                                   </div>
                                   </div>
                                   </div>
                                   <!-- <span class="clearfix"></span> -->
                                                                                 
                             </div><!--roomBoxWrap list row closed here-->
                             <% }  
                             } %>
                             
                    </div>
                  </div>
                </div>


          </div>
        </div>


</div>
        

    <!--/.Content-->
    
 <%- include('footer75'); %>         

<script type="text/javascript">
<% if(!Bingo.user_bingo_credits) { %>
  $('#transfer_div').show();
<% } %>
<% if(Bingo.user_bingo_credits > 0) { %>
  $('#transfer_div').hide();
<% } %>
    Room = {
        cards:1,
        room_id: false,
        game_id:false
    };
    /*$('.chosen-room').find('.room-cards').on('change', function(){

    })*/
    $('.chosen-room').find('a').on('click', function(e){
        e.preventDefault();

        Room.room_id = $(this).attr('data-room');
        Room.game_id = $(this).attr('data-game');
        Room.cards = $(this).parent('.roomDetailsLeft').find('.room-cards').val();
        //console.log(Room);
        //return;
        if(Room.room_id && Room.game_id){
        
            $.ajax({
              type: "POST",
              url: '/api/gotobingo75',
              data: JSON.stringify({Room}),
              success: function(res){
                console.log('logged in'+ res);
                if(res.status){
                    window.location.href = '/bingo75';
                    return;
                }
                if(!res.status){
                    $('#error').addClass('error-red red text-center' ).html('not enough credits! tranfer credits to bingo or get more credits');
                    return;
                }
              },
              error:function(xhr){
                $('#error').addClass('error-red red').html('There is some issue!');
              },
              dataType: 'json',
              contentType: "application/json; charset=utf-8",
            });
        } else{
            alert('oops! something went wrong!');
        }
    });
    

     $('#transfer').on('click', function(){ 
    var total_credits = parseInt($('#total_credits').val());
    var transfer_credits = parseInt($('#transfer_credits').val());
    console.log('cliked', total_credits, transfer_credits)
    if(total_credits >= transfer_credits){
    $.ajax({
              type: "POST",
              url: '/api/transfer_credits',
              data: JSON.stringify({total_credits:total_credits, transfer_credits:transfer_credits}),
              success: function(res){
                console.log('logged in'+ res.transfer_credits);
                  $('#bingo_credits').focus();
                  $('#transfer_credits').val(0);
                  $('#bingo_credits').val(res.transfer_credits);
                  $('#won_credits').html(res.transfer_credits);
                  $('#transfer_div').hide();
                  window.location.href = '/bingo75/rooms';
                    return;
              },
              error:function(xhr){
                $('#transfer_error').addClass('error-red red').html('Transfer error, try again!');
              },
              dataType: 'json',
              contentType: "application/json; charset=utf-8",
            });
    } else {
      $('#transfer_error').html('<h1 class="error-red red">You don\'t have enought Credits!</h1>');
    }
    
    
  })
</script>
